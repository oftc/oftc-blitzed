#
# Makefile.in for services/src
#
# $Id$
#
@SET_MAKE@

CC		        = @CC@
CFLAGS          = @OUR_CFLAGS@
INSTALL		    = @INSTALL@
INSTALL_BIN	    = @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@
LEX		        = @LEX@
LDFLAGS   	    = @OUR_LDFLAGS@
MKDEP		    = @MKDEP@
STDOUT		    = @STDOUT@
MV		        = @MV@
RM		        = @RM@
SED		        = @SED@
YACC		    = @YACC@

prefix		    = @prefix@
exec_prefix	    = @exec_prefix@
bindir		    = @bindir@
sysconfdir	    = @sysconfdir@
localstatedir	= @localstatedir@
logdir          = @LOGDIR@

# must not have whitespace here
CLOBBER=@CLOBBER@

PROGS		= services

INCLUDES	= -I../include
CPPFLAGS	= ${INCLUDES} @CPPFLAGS@ -I@MYSQL_INCLUDEDIR@
 
default:	all

BASE_SRCS =	\
 actions.c \
 akill.c \
 auth.c \
 autojoin.c \
 cache.c \
 channels.c \
 chanserv.c \
 commands.c \
 compat.c \
 config.c \
 cs_access.c \
 floodserv.c \
 helpserv.c \
 init.c \
 ircmacros.c \
 language.c \
 log.c \
 main.c \
 memory.c \
 memoserv.c \
 messages.c \
 misc.c \
 mysql.c \
 news.c \
 nickserv.c \
 operserv.c \
 process.c \
 quarantine.c \
 send.c \
 servers.c \
 sessions.c \
 sha1.c \
 sockutil.c \
 timeout.c \
 tools.c \
 users.c \
 vsnprintf.c

SRCS = ${BASE_SRCS} 
OBJS = ${SRCS:.c=.o}

all: .depend services

build: all

services: $(OBJS) #y.tab.o lex.yy.o 
	${CC} ${CFLAGS} ${LDFLAGS} -o $@ ${OBJS} @MYSQL_LIBS@

install-mkdirs:
	mkdir -p $(prefix) $(exec_prefix) $(bindir) $(sysconfdir) \
		$(prefix)/logs 

install: install-mkdirs build
	@for i in $(PROGS); do \
		if test -f $(bindir)/$$i -a -z "$(CLOBBER)"; then \
			echo $(MV) $(bindir)/$$i $(bindir)/$$i.old; \
			$(MV) $(bindir)/$$i $(bindir)/$$i.old; \
		fi; \
		echo $(INSTALL_BIN) $$i $(bindir); \
		$(INSTALL_BIN) $$i $(bindir); \
	done


# this is really the default rule for c files
.c.o:
	${CC} ${CPPFLAGS} ${CFLAGS} -c $<

.depend:
	${MKDEP} ${CPPFLAGS} ${BASE_SRCS} ${STDOUT}
	@${SED} -e '/^# Autogenerated: do not delete/,$$d' <Makefile >Makefile.depend
	@echo "# Autogenerated - do not delete" >> Makefile.depend
	@echo "include .depend" >> Makefile.depend
	@${MV} Makefile.depend Makefile

clean:
	${RM} -f *.o *.exe *~ y.tab.* lex.yy.c *core services

distclean: clean
	${RM} -f Makefile .depend

.PHONY: clean distclean install install-mkdirs build
